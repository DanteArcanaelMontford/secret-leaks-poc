pipeline:
  agent:
    docker:
      image: alpine:3.19
      args: "-v /var/run/docker.sock:/var/run/docker.sock"

  stages:

    - stage: Checkout
      steps:
        - checkout:
            scm:
              $class: GitSCM
              userRemoteConfigs:
                - url: "https://github.com/WebGoat/WebGoat.git"
              branches:
                - name: "*/main"
              extensions:
                - $class: CloneOption
                  shallow: false   # ğŸ”‘ HISTÃ“RICO COMPLETO

    - stage: Security Gate - Gitleaks
      steps:
        - sh: |
            echo "ğŸ” Executando Security Gate (Gitleaks)"

            docker run --rm \
              -v "$(pwd):/repo" \
              zricethezav/gitleaks:latest \
              detect \
              --source=/repo \
              --redact \
              --exit-code 1

    - stage: Build
      steps:
        - sh: |
            echo "ğŸ—ï¸ Build iniciado (sÃ³ se gate passar)"
            echo "SimulaÃ§Ã£o de build"
